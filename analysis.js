// Boilerplate for reading large JSON file.
// Courtesy of https://stackoverflow.com/a/16013228
var fs = require('fs'),
    readline = require('readline'),
    stream = require('stream');

var instream = fs.createReadStream('shodan-export.json');
var outstream = new stream;
outstream.readable = true;
outstream.writable = true;

var rl = readline.createInterface({
    input: instream,
    output: outstream,
    terminal: false
});

// Reduced data.
var reduction = {};

// Process file
rl.on('line', function(line) {

    // Parse JSON line.
    var shodan = JSON.parse(line);

    // Increment institution count.
    if (shodan.org in reduction) {
        reduction[shodan.org] += 1;
    } else {
        reduction[shodan.org] = 1;
    }
});

// Report.
rl.on('close', function() {
    console.log(reduction);
});